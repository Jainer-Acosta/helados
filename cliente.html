<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Pedidos de Helado - Cliente</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .formulario {
        display: flex;
        gap: 20px;
      }
      .seccion,
      .resumen {
        flex: 1;
        border: 1px solid #ccc;
        padding: 20px;
        border-radius: 10px;
      }
      .sabores img,
      .toppings-adicionales img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 10px;
      }
      .sabores label,
      .toppings-adicionales label {
        display: inline-block;
        margin-right: 15px;
        text-align: center;
      }
      #qrImagen {
        display: none;
        margin-top: 10px;
      }
      #mensajePago {
        font-weight: bold;
        color: green;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Formulario de Pedido - Cliente</h1>
    <div class="formulario">
      <div class="seccion">
        <form id="pedidoForm">
          <label
            >Nombre:
            <input
              type="text"
              id="nombre"
              required
              oninput="actualizarResumen()" /></label
          ><br /><br />
          <label
            >Apellido:
            <input
              type="text"
              id="apellido"
              required
              oninput="actualizarResumen()" /></label
          ><br /><br />

          <label>Sabor de helado:</label><br />
          <div class="sabores">
            <label
              ><input
                type="radio"
                name="sabor"
                value="Vainilla"
                onchange="actualizarResumen()"
              />
              <br /><img src="vainilla.jpg" /><br />Vainilla</label
            >
            <label
              ><input
                type="radio"
                name="sabor"
                value="Chocolate"
                onchange="actualizarResumen()"
              />
              <br /><img src="chocolate.jpg" /><br />Chocolate</label
            >
            <label
              ><input
                type="radio"
                name="sabor"
                value="Fresa"
                onchange="actualizarResumen()"
              />
              <br /><img src="fresa.jpg" /><br />Fresa</label
            >
          </div>
          <br />

          <label>Cantidad de bolas ($2.000 c/u):</label>
          <input
            type="number"
            id="bolas"
            min="1"
            max="3"
            value="1"
            onchange="actualizarResumen()"
          /><br /><br />

          <label>Topping gratis:</label>
          <select id="toppingGratis" onchange="actualizarResumen()">
            <option value="Chispas">Chispas</option>
            <option value="Sirope">Sirope</option>
            <option value="Galleta">Galleta</option>
            <option value="Frutas">Frutas</option></select
          ><br /><br />

          <div class="toppings-adicionales">
            <p>Toppings adicionales ($1.000 c/u):</p>
            <label
              ><input
                type="checkbox"
                value="Chispas"
                onchange="actualizarResumen()"
              />
              <br /><img src="chispas.jpg" />Chispas</label
            >
            <label
              ><input
                type="checkbox"
                value="Sirope"
                onchange="actualizarResumen()"
              />
              <br /><img src="sirope.jpg" />Sirope</label
            >
            <label
              ><input
                type="checkbox"
                value="Galleta"
                onchange="actualizarResumen()"
              />
              <br /><img src="galleta.jpg" />Galleta</label
            >
            <label
              ><input
                type="checkbox"
                value="Frutas"
                onchange="actualizarResumen()"
              />
              <br /><img src="frutas.jpg" />Frutas</label
            >
          </div>
          <br />

          <p>Método de pago:</p>
          <button type="button" onclick="seleccionarPago('efectivo')">
            Efectivo
          </button>
          <button type="button" onclick="seleccionarPago('nequi')">
            Nequi
          </button>
          <div id="mensajePago"></div>
          <img
            id="qrImagen"
            src="./img/WhatsApp Image 2025-04-19 at 1.02.43 PM.jpeg"
            width="200"
            alt="QR Nequi"
          />

          <br /><br />
          <button type="submit">Confirmar Pedido</button>
        </form>
      </div>

      <div class="resumen">
        <h2>Resumen del Pedido</h2>
        <div id="resumenPedido"></div>
      </div>
    </div>

    <script>
      let contadorPedido = 1;
      let metodoPago = "";

      function seleccionarPago(metodo) {
        metodoPago = metodo;
        const mensaje = document.getElementById("mensajePago");
        const qr = document.getElementById("qrImagen");

        if (metodo === "efectivo") {
          mensaje.textContent = "Por favor, dirígete a la caja para pagar.";
          qr.style.display = "none";
        } else {
          mensaje.textContent =
            "Escanea el siguiente código QR para pagar con Nequi.";
          qr.style.display = "block";
        }
        actualizarResumen();
      }

      function actualizarResumen() {
        const nombre = document.getElementById("nombre").value;
        const apellido = document.getElementById("apellido").value;
        const sabor =
          document.querySelector("input[name='sabor']:checked")?.value || "";
        const bolas = parseInt(document.getElementById("bolas").value || 1);
        const toppingGratis = document.getElementById("toppingGratis").value;
        const adicionales = Array.from(
          document.querySelectorAll(".toppings-adicionales input:checked")
        ).map((cb) => cb.value);

        const precioBolas = bolas * 2000;
        const precioAdicionales = adicionales.length * 1000;
        const total = precioBolas + precioAdicionales;

        document.getElementById("resumenPedido").innerHTML = `
        <strong>Cliente:</strong> ${nombre} ${apellido}<br>
        <strong>Sabor:</strong> ${sabor}<br>
        <strong>Bolas:</strong> ${bolas} x $2.000 = $${precioBolas}<br>
        <strong>Topping gratis:</strong> ${toppingGratis}<br>
        <strong>Adicionales:</strong> ${
          adicionales.length ? adicionales.join(", ") : "Ninguno"
        }<br>
        <strong>Precio adicionales:</strong> $${precioAdicionales}<br>
        <strong>Método de pago:</strong> ${metodoPago || "No seleccionado"}<br>
        <hr>
        <strong>Total a pagar:</strong> $${total}
      `;
      }

      document
        .getElementById("pedidoForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const nombre = document.getElementById("nombre").value;
          const apellido = document.getElementById("apellido").value;
          const sabor = document.querySelector(
            "input[name='sabor']:checked"
          ).value;
          const bolas = parseInt(document.getElementById("bolas").value);
          const toppingGratis = document.getElementById("toppingGratis").value;
          const adicionales = Array.from(
            document.querySelectorAll(".toppings-adicionales input:checked")
          ).map((cb) => cb.value);
          const precioBolas = bolas * 2000;
          const precioAdicionales = adicionales.length * 1000;
          const total = precioBolas + precioAdicionales;

          const pedido = {
            numero: contadorPedido++,
            nombre,
            apellido,
            sabor,
            bolas,
            toppingGratis,
            adicionales,
            metodoPago,
            total,
          };

          localStorage.setItem(
            "pedido" + pedido.numero,
            JSON.stringify(pedido)
          );
          alert("¡Pedido confirmado!");
          document.getElementById("pedidoForm").reset();
          document.getElementById("mensajePago").textContent = "";
          document.getElementById("qrImagen").style.display = "none";
          metodoPago = "";
          actualizarResumen();
        });
    </script>
  </body>
</html>
